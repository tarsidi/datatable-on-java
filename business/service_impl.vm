## Key fields = fields in Primary Key    
#set( $keyFields = $entity.getAttributesByCriteria( $const.KEY ) )
##--------------------------------------------------------------------------------------------------------
## Data fields = fields not in Primary Key and not in selected Links    
#set( $dataFields = $entity.getAttributesByCriteria( $const.NOT_KEY, $const.NOT_IN_SELECTED_LINKS ) )
##--------------------------------------------------------------------------------------------------------
## All fields ( ordered fiels : 1) fields in Primary Key 2) fields not in primary key    
#set( $allFields = $fn.concatLists($keyFields, $dataFields) )
##--------------------------------------------------------------------------------------------------------
#if( $entity.hasCompositePrimaryKey() )
#set( $entityKeyType = ${entity.name} + "EntityKey" )
#else
#set( $entityKeyType = ${entity.keyAttributes[0].formattedType(0)} )
#end
##--------------------------------------------------------------------------------------------------------
/*
 * Created on $today.date ( Time $today.time )
 * Generated by $generator.name ( version $generator.version )
 */
package ${target.javaPackageFromFolder(${SRC})};

import java.util.ArrayList;
import java.util.List;

import javax.annotation.Resource;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

import ${ENTITY_PKG}.${entity.name};
import ${ENTITY_PKG}.jpa.${entity.name}Entity;
#if( $entity.hasCompositePrimaryKey() )
import ${ENTITY_PKG}.jpa.${entity.name}EntityKey;
#end
#foreach( $import in $java.imports($entity) )
import $import;
#end
import ${ROOT_PKG}.business.service.${entity.name}Service;
import ${ROOT_PKG}.business.service.mapping.${entity.name}ServiceMapper;
import ${ROOT_PKG}.data.repository.jpa.${entity.name}JpaRepository;
import ${ROOT_PKG}.data.repository.jpa.${entity.name}SpecRepository;
import ${ROOT_PKG}.data.repository.specifications.${entity.name}Specifications;

import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

/**
 * Implementation of ${entity.name}Service
 */
@Component
@Transactional
public class ${entity.name}ServiceImpl implements ${entity.name}Service {

	@Resource
	private ${entity.name}JpaRepository ${fn.uncapitalize($entity.name)}JpaRepository;

	@Resource
	private ${entity.name}SpecRepository ${fn.uncapitalize($entity.name)}SpecRepository;

	@Resource
	private ${entity.name}ServiceMapper ${fn.uncapitalize($entity.name)}ServiceMapper;
	
	
	public ${entity.name} findById(${fn.argumentsListWithType($entity.keyAttributes)}) {
#if( $entity.hasCompositePrimaryKey() )
		${entityKeyType} id = new ${entityKeyType}(${fn.argumentsList($entity.keyAttributes)});
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(id);
#else
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(${fn.argumentsList($entity.keyAttributes)});
#end
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}Entity);
	}

	
	public List<${entity.name}> findAll() {
		Iterable<${entity.name}Entity> entities = ${fn.uncapitalize($entity.name)}JpaRepository.findAll();
		List<${entity.name}> beans = new ArrayList<${entity.name}>();
		for(${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity : entities) {
			beans.add(${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}Entity));
		}
		return beans;
	}

	
	public ${entity.name} save(${entity.name} ${fn.uncapitalize($entity.name)}) {
		return update(${fn.uncapitalize($entity.name)}) ;
	}

	
	public ${entity.name} create(${entity.name} ${fn.uncapitalize($entity.name)}) {
#if( $entity.hasCompositePrimaryKey() )
		${entityKeyType} id = new ${entityKeyType}(${fn.argumentsListWithGetter($fn.uncapitalize($entity.name),$entity.keyAttributes)});
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(id);
#else
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(${fn.argumentsListWithGetter($fn.uncapitalize($entity.name),$entity.keyAttributes)});
#end
		if( ${fn.uncapitalize($entity.name)}Entity != null ) {
			throw new IllegalStateException("already.exists");
		}
		${fn.uncapitalize($entity.name)}Entity = new ${entity.name}Entity();
		${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}To${entity.name}Entity(${fn.uncapitalize($entity.name)}, ${fn.uncapitalize($entity.name)}Entity);
		${entity.name}Entity ${fn.uncapitalize($entity.name)}EntitySaved = ${fn.uncapitalize($entity.name)}JpaRepository.save(${fn.uncapitalize($entity.name)}Entity);
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}EntitySaved);
	}

	
	public ${entity.name} update(${entity.name} ${fn.uncapitalize($entity.name)}) {
#if( $entity.hasCompositePrimaryKey() )
		${entityKeyType} id = new ${entityKeyType}(${fn.argumentsListWithGetter($fn.uncapitalize($entity.name),$entity.keyAttributes)});
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(id);
#else
		${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity = ${fn.uncapitalize($entity.name)}JpaRepository.findOne(${fn.argumentsListWithGetter($fn.uncapitalize($entity.name),$entity.keyAttributes)});
#end
		${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}To${entity.name}Entity(${fn.uncapitalize($entity.name)}, ${fn.uncapitalize($entity.name)}Entity);
		${entity.name}Entity ${fn.uncapitalize($entity.name)}EntitySaved = ${fn.uncapitalize($entity.name)}JpaRepository.save(${fn.uncapitalize($entity.name)}Entity);
		return ${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}EntitySaved);
	}

	
	public void delete(${fn.argumentsListWithType($entity.keyAttributes)}) {
#if( $entity.hasCompositePrimaryKey() )
		${entityKeyType} id = new ${entityKeyType}(${fn.argumentsList($entity.keyAttributes)});
		${fn.uncapitalize($entity.name)}JpaRepository.delete(id);
#else
		${fn.uncapitalize($entity.name)}JpaRepository.delete(${fn.argumentsList($entity.keyAttributes)});
#end
	}

	public ${entity.name}JpaRepository get${entity.name}JpaRepository() {
		return ${fn.uncapitalize($entity.name)}JpaRepository;
	}

	public void set${entity.name}JpaRepository(${entity.name}JpaRepository ${fn.uncapitalize($entity.name)}JpaRepository) {
		this.${fn.uncapitalize($entity.name)}JpaRepository = ${fn.uncapitalize($entity.name)}JpaRepository;
	}

	public ${entity.name}ServiceMapper get${entity.name}ServiceMapper() {
		return ${fn.uncapitalize($entity.name)}ServiceMapper;
	}

	public void set${entity.name}ServiceMapper(${entity.name}ServiceMapper ${fn.uncapitalize($entity.name)}ServiceMapper) {
		this.${fn.uncapitalize($entity.name)}ServiceMapper = ${fn.uncapitalize($entity.name)}ServiceMapper;
	}

	public Long countAll() {
		return ${fn.uncapitalize($entity.name)}JpaRepository.count();
	}

	public List<${entity.name}> findAll(Pageable pageable) {
		List<${entity.name}> result = new ArrayList<${entity.name}>();
		Page<${entity.name}Entity> entities = ${fn.uncapitalize($entity.name)}JpaRepository.findAll(pageable);
		for(${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity : entities) {
			result.add(${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}Entity));
		}
		return result;
	}

	public List<${entity.name}> findWithSpec(${entity.name}Specifications specifications, Pageable pageable){
		List<${entity.name}> result = new ArrayList<${entity.name}>();
		Page<${entity.name}Entity> entities = ${fn.uncapitalize($entity.name)}SpecRepository.findAll(specifications, pageable);
		for(${entity.name}Entity ${fn.uncapitalize($entity.name)}Entity : entities) {
			result.add(${fn.uncapitalize($entity.name)}ServiceMapper.map${entity.name}EntityTo${entity.name}(${fn.uncapitalize($entity.name)}Entity));
		}
		return result;
	}

	public Long countWithSpec(${entity.name}Specifications specifications){
		return ${fn.uncapitalize($entity.name)}SpecRepository.count(specifications);
	}
}
